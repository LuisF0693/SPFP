# 4.10: Otimização & Testes Finais

**Status:** Ready
**Sprint:** 8
**Points:** 3
**Epic:** EPIC-004

---

## User Story

**Como** time de QA
**Quero** garantir que o Virtual Office atende todos os critérios de performance e testes
**Para que** o launch seja seguro e confiável

---

## Description

Fase final de otimização e validação:
- Performance: Mapa < 2s, dashboards < 500ms
- Testes: 80%+ coverage, todos passando
- Acessibilidade: WCAG AA mínimo
- Lighthouse scores > 80
- Zero console errors
- Browser compatibility

---

## Acceptance Criteria

### AC-410.1: Performance Mapa
- [ ] Canvas carrega em < 2 segundos
- [ ] DevTools: First Paint < 800ms
- [ ] Time to Interactive < 1.5s
- [ ] Idle Time > 50ms

### AC-410.2: Performance Dashboards
- [ ] Modal abre em < 500ms
- [ ] Charts renderizam em < 300ms
- [ ] Scroll fluido (60 FPS)
- [ ] No jank durante interações

### AC-410.3: Bundle Size
- [ ] Main chunk < 150kb
- [ ] Code split por dashboard
- [ ] Lazy load imagens
- [ ] Tree-shake unused code

### AC-410.4: Lighthouse Scores
- [ ] Performance: > 80
- [ ] Accessibility: > 85
- [ ] Best Practices: > 90
- [ ] SEO: > 80

### AC-410.5: Unit Tests
- [ ] VirtualOfficeContext: 10+ tests
- [ ] Components: 50+ tests total
- [ ] Coverage: 80%+
- [ ] All passing ✅

### AC-410.6: Integration Tests
- [ ] Tab navigation works
- [ ] Data flows correctly
- [ ] Drag & drop functional
- [ ] Forms submit properly

### AC-410.7: Acessibilidade
- [ ] Keyboard navigation: ✅
- [ ] Screen reader labels: ✅
- [ ] Color contrast: WCAG AA ✅
- [ ] Focus indicators: visible

### AC-410.8: Browser Compatibility
- [ ] Chrome 90+: ✅
- [ ] Firefox 88+: ✅
- [ ] Safari 14+: ✅
- [ ] Edge 90+: ✅

### AC-410.9: Mobile Performance
- [ ] Lighthouse Mobile > 75
- [ ] Touch interactions smooth
- [ ] No janky scrolls
- [ ] Tap response < 100ms

---

## Scope

### IN
- Performance testing & optimization
- Unit tests + integration tests
- Accessibility audit
- Browser testing
- Bundle analysis
- Documentation

### OUT
- E2E tests (phase 2)
- Load testing (50+ concurrent users)
- Sentry error tracking setup
- Analytics implementation

---

## Technical Notes

### Performance Tools
```bash
npm run lighthouse -- http://localhost:3000/corporate
npm run analyze -- --bundle
npm run bundle-report
```

### Testing
```bash
npm run test           # Unit tests
npm run test:ui       # Interactive
npm run test:coverage # Coverage report
```

### Accessibility
```bash
npm run a11y-check
# Manual: NVDA, JAWS, or VoiceOver on real devices
```

### Profiling
```tsx
// React DevTools Profiler
import { Profiler } from 'react';

<Profiler id="VirtualOffice" onRender={onRender}>
  <VirtualOffice />
</Profiler>
```

---

## Dependencies

**Depends On:** US-401 through US-409 (all complete)
**Blocks:** Launch ready

---

## Definition of Done

- [x] All performance targets met
- [x] All tests passing (80%+ coverage)
- [x] Lighthouse scores verified
- [x] Accessibility audit passed
- [x] Browser compatibility tested
- [x] Zero console errors
- [x] Documentation complete
- [x] Ready for QA gate

---

## File List

- [ ] src/__tests__/virtual-office.integration.test.ts
- [ ] docs/performance/EPIC-004-PERF-REPORT.md
- [ ] docs/accessibility/EPIC-004-A11Y-REPORT.md
- [ ] docs/EPIC-004-COMPLETE.md (handoff notes)

---

## Checklist for Launch

- [ ] Performance targets met
- [ ] All AC from US-401 to US-409 verified
- [ ] Tests 80%+ coverage + all passing
- [ ] Lighthouse Mobile > 75, Desktop > 80
- [ ] Accessibility WCAG AA
- [ ] Zero console errors
- [ ] Browser compatibility verified
- [ ] Documentation complete
- [ ] Code reviewed by @qa
- [ ] Approved for merge by @devops

---

## Points Breakdown

- Performance optimization: 1 pt
- Testing (units + integration): 1.5 pts
- Accessibility audit: 0.5 pts

---

## Change Log

- **2026-02-17:** Created as final story

---

## Notes for QA

- Use real devices for testing, not just emulators
- Check performance on slow networks (3G throttle)
- Verify accessibility with multiple screen readers
- Test on various orientations (portrait/landscape)
- Edge cases: 0 activities, 1000+ leads, network timeout
