# 4.1: Visualizar Escritório Virtual com 4 Salas Temáticas

**Status:** Ready
**Sprint:** 5
**Points:** 8
**Epic:** EPIC-004

---

## User Story

**Como** empresário
**Quero** visualizar um escritório virtual pixel art com múltiplas salas temáticas
**Para que** eu tenha uma visão imersiva e engajadora da minha empresa

---

## Description

Criar o mapa base do escritório virtual em Phaser 3 com 4 salas temáticas (Estratégia, Ideação, Produção, Design). Cada sala deve ter:
- Background temático com cor de departamento
- Mobiliário pixel art (mesas, cadeiras, computadores)
- NPCs posicionados nas salas
- Canvas responsivo que carrega em < 2 segundos

---

## Acceptance Criteria

### AC-401.1: Mapa carrega em < 2 segundos
- [ ] Canvas renderiza sem delay perceptível
- [ ] Performance monitored com DevTools
- [ ] No console errors

### AC-401.2: 4 salas base implementadas
- [ ] Sala Estratégia (background #6366F1)
- [ ] Sala Ideação (background #EC4899)
- [ ] Sala Produção (background #06B6D4)
- [ ] Sala Design (background #F97316)

### AC-401.3: Cada sala tem background temático
- [ ] Background cor do departamento (20% opacity overlay)
- [ ] Dimensões: 256×192 pixels cada (8×6 tiles)
- [ ] Coordenadas no mapa são claras

### AC-401.4: Mobiliário renderizado
- [ ] Mesas (32×32) em cada sala
- [ ] Cadeiras (16×16) posicionadas
- [ ] Computadores (32×32) nas mesas
- [ ] Plantas (24×32) decorativas
- [ ] Quadros brancos (48×32) nas paredes

### AC-401.5: NPCs posicionados
- [ ] 1 NPC por sala (CFO, CMO, COO, CSO)
- [ ] NPCs mostram idle animation (4 frames)
- [ ] Nome do NPC aparece abaixo quando hover
- [ ] Avatar renderiza corretamente

### AC-401.6: Canvas responsivo
- [ ] Desktop: Canvas 70% da tela
- [ ] Tablet: Canvas 100% da altura
- [ ] Mobile: Canvas em tab (full screen)
- [ ] Sem distorção em qualquer tela

### AC-401.7: Clique em sala selecionada
- [ ] Clique em sala resalta borda (department color)
- [ ] Visual feedback imediato
- [ ] Modal não abre ainda (placeholder)

### AC-401.8: Sem erros de console
- [ ] Zero erros
- [ ] Zero warnings (exceto as esperadas)
- [ ] Lighthouse Performance > 80

---

## Scope

### IN (Incluído)
- Mapa com 4 salas
- Mobiliário básico em pixel art (CSS ou SVG)
- NPCs com idle animation
- Canvas Phaser 3 integrado
- Responsividade básica

### OUT (Não Incluído)
- Movement do NPC
- Dashboards (vêm em US-403+)
- Multiplayer sync
- Chat ou interações avançadas
- Sprite sheets customizadas (usar CSS emojis/fonts primeiro)

---

## Technical Notes

### Implementation Approach
1. **Phaser Scene Setup**
   - Cria `VirtualOfficeScene.ts` estendendo Phaser.Scene
   - Viewport: 1024×768 pixels
   - Grid: 32×32 tiles

2. **Room Data Structure**
   ```typescript
   interface VirtualRoom {
     id: string;
     name: string;
     x: number; // start X tile
     y: number; // start Y tile
     width: number; // tiles
     height: number; // tiles
     backgroundColor: string;
     icon: string;
     npc: { name: string; role: string; animKey: string };
   }
   ```

3. **Rendering**
   - Backgrounds via Graphics object ou tile map
   - Mobiliário via Sprite ou graphics primitives
   - NPCs via Sprite (animation desde sprite sheet)

4. **Animations**
   - Idle: 4 frames @ 200ms/frame
   - Carregado em `preload()` via Phaser AnimationManager

### File Structure
```
src/components/corporate/
├── VirtualOffice.tsx (main container)
├── Map.tsx (Phaser wrapper)
├── phaser/
│   ├── VirtualOfficeScene.ts (NEW)
│   ├── RoomManager.ts (NEW)
│   └── NPCManager.ts (NEW)
└── types/
    └── virtual-office.ts (NEW)
```

### Dependencies
- Phaser 3.80.1 ✅ (já instalado)
- TypeScript ✅
- React Context (VirtualOfficeContext para state)

---

## Definition of Done

- [x] Code written and tested locally
- [x] No console errors/warnings
- [x] TypeScript types complete
- [x] Responsive on desktop/tablet/mobile
- [x] Performance > 80 Lighthouse
- [x] Commits pushed to `feature/virtual-office-map`
- [x] PR created with description
- [x] @qa gate passed (no blockers)

---

## Dependencies

**Blocks:** US-402 (Navigation), US-407 (Feed positioning)

**Depends On:** None (first story)

---

## Estimated Breakdown

- **Setup Phaser Scene:** 2 pts
- **Room Rendering:** 2 pts
- **Mobiliário Assets:** 2 pts
- **NPC Rendering + Animation:** 1.5 pts
- **Responsivity + Polishing:** 0.5 pts

---

## Risks

| Risk | Mitigation |
|---|---|
| Phaser learning curve | Reference existing PhaserGame.tsx component |
| Performance issues | Use requestAnimationFrame, avoid heavy calculations |
| Asset loading delay | Preload sprites early, use placeholder shapes |

---

## File List

- [ ] src/components/corporate/phaser/VirtualOfficeScene.ts
- [ ] src/components/corporate/phaser/RoomManager.ts
- [ ] src/components/corporate/phaser/NPCManager.ts
- [ ] src/types/virtual-office.ts
- [ ] docs/design/EPIC-004-VISUAL-STYLE-GUIDE.md (reference)

---

## Change Log

- **2026-02-17:** Story created (US-401)
- **Status:** Ready for development

---

## Notes for Dev

- Usar o padrão já estabelecido em `PhaserGame.tsx`
- Phaser Scene roda dentro de React component via useRef
- State management via Context (VirtualOfficeContext)
- Testes unitários para RoomManager + NPCManager
- Documentar padrão de integração Phaser + React para futuros devs
