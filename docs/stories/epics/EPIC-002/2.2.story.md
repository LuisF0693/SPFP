# 2.2: Pipeline Feed com Atividades em Tempo Real

**Status:** Draft
**Sprint:** 7
**Points:** 8
**Epic:** EPIC-002

---

## User Story

**Como** empresário
**Quero** ver um feed lateral mostrando atividades dos departamentos em tempo real
**Para que** eu acompanhe o que está acontecendo em minha empresa a cada momento

---

## Description

Implementar um feed de atividades posicionado na lateral direita (ou inferior em mobile) mostrando atividades dos 4 departamentos. Cada atividade exibe: agente responsável, horário, descrição breve e status visual (RUNNING, IDLE, WAITING, COMPLETED). Suporta scroll infinito, filtro por departamento, novas atividades aparecem no topo com animação, e gates de aprovação com botões interativos.

---

## Acceptance Criteria

### AC-002.1: Feed Posicionado Corretamente
- [ ] Desktop: Feed na lateral direita do mapa (grid layout)
- [ ] Tablet: Feed abaixo do mapa
- [ ] Mobile: Feed acessível via tab ou drawer
- [ ] Altura/largura otimizadas para cada breakpoint

### AC-002.2: Scroll Infinito de Atividades
- [ ] Feed suporta scroll vertical
- [ ] Carrega mais atividades ao atingir final (paginação)
- [ ] Máximo 100 atividades em memória
- [ ] Placeholder "Carregando..." ao buscar mais

### AC-002.3: Cada Atividade Mostra Informações Completas
- [ ] Ícone/Avatar do agente
- [ ] Nome do agente (ex: "CFO")
- [ ] Horário da atividade (ex: "10:45")
- [ ] Descrição da atividade (ex: "Analisando fluxo de caixa")
- [ ] Status visual

### AC-002.4: Status Badges com Ícones e Cores
- [ ] RUNNING: Verde (#10B981) com ícone "play" ou "spinner"
- [ ] IDLE: Cinza (#9CA3AF) com ícone "pause"
- [ ] WAITING: Amarelo (#F59E0B) com ícone "clock"
- [ ] COMPLETED: Verde (#10B981) com ícone "checkmark"
- [ ] ERROR: Vermelho (#EF4444) com ícone "x"

### AC-002.5: Filtro por Departamento
- [ ] Dropdown/selector com opções: Todos, Financeiro, Marketing, Operacional, Comercial
- [ ] Filtro funciona em tempo real
- [ ] Label visível no topo do feed

### AC-002.6: Novas Atividades Aparecem no Topo com Animação
- [ ] Nova atividade surge no topo do feed
- [ ] Animação fade-in + slide (framer-motion)
- [ ] Outras atividades descem suavemente
- [ ] Sem lag perceptível

### AC-002.7: Clique em Atividade Expande Detalhes
- [ ] Clique/tap expande atividade
- [ ] Mostra campos adicionais se existirem (metadata)
- [ ] Pode revelar botões de ação
- [ ] Clique novamente recolhe

### AC-002.8: Gates de Aprovação com Botões Interativos
- [ ] Atividades com requires_approval=true mostram botões
- [ ] Botão "Aprovar" (verde)
- [ ] Botão "Rejeitar" (vermelho)
- [ ] Clique chama função callback
- [ ] Atividade desaparece após ação (ou muda status)

---

## Scope

### IN (Incluído)
- Feed lateral com atividades dos departamentos
- Scroll infinito com paginação
- 5 status badges (RUNNING, IDLE, WAITING, COMPLETED, ERROR)
- Filtro por departamento
- Animação para novas atividades
- Expansão de detalhes ao clicar
- Gates de aprovação (botões Aprovar/Rejeitar)
- Responsividade (desktop lateral, tablet/mobile abaixo ou drawer)

### OUT (Não Incluído)
- Integração real-time com Supabase (usar mock data primeiro)
- Chat entre agentes
- Notificações push
- Exportação de histórico
- Busca de atividades

---

## Technical Notes

### Implementation Approach

1. **Component Principal** (`src/components/corporate/PipelineFeed.tsx`)
   - Gerencia lista de atividades (state ou context)
   - Renderiza scroll infinito
   - Filtra por departamento

2. **Sub-componentes**
   - `ActivityCard.tsx` (NEW) - card individual de atividade
   - `StatusBadge.tsx` (NEW) - badge com ícone e cor
   - `ApprovalGate.tsx` (NEW) - botões Aprovar/Rejeitar

3. **Mock Data**
   - `src/data/mockActivities.ts` (NEW) com 50-100 atividades mockadas
   - Simular chegada de novas atividades com setInterval

4. **Libraries**
   - framer-motion (animações)
   - react-icons (Lucide) para badges
   - TailwindCSS (layout, responsividade)

5. **File Structure**
```
src/components/
├── corporate/
│   ├── PipelineFeed.tsx (NEW)
│   ├── ActivityCard.tsx (NEW)
│   ├── StatusBadge.tsx (NEW)
│   └── ApprovalGate.tsx (NEW)
└── data/
    └── mockActivities.ts (NEW)
```

6. **Data Model** (typescript)
```typescript
interface ActivityFeedItem {
  id: string;
  department: 'financeiro' | 'marketing' | 'operacional' | 'comercial';
  agent_name: string;
  agent_role: string;
  description: string;
  status: 'running' | 'idle' | 'waiting' | 'completed' | 'error';
  requires_approval: boolean;
  created_at: string; // ISO timestamp
  metadata?: Record<string, any>;
}
```

---

## Definition of Done

- [ ] PipelineFeed renderiza em desktop/tablet/mobile
- [ ] Scroll infinito funcional com paginação
- [ ] 5 status badges com cores e ícones corretos
- [ ] Filtro por departamento funcional
- [ ] Novas atividades animam corretamente
- [ ] Expansão de detalhes ao clicar
- [ ] Botões Aprovar/Rejeitar funcionam (callback)
- [ ] Mock data mockActivities.ts em lugar
- [ ] Lighthouse Performance > 85
- [ ] Sem console errors
- [ ] Testes unitários para ActivityCard, StatusBadge, ApprovalGate
- [ ] Commit local

---

## Dependencies

**Blocks:** US-203, US-204, US-205, US-206 (podem usar feed para ações)

**Depends On:** US-201 (CorporateHQ base)

---

## Business Value

**Alto** - Fornece visibilidade em tempo real das atividades dos departamentos

---

## Risks

| Risk | Mitigation |
|------|-----------|
| Performance com 1000+ atividades | Paginação, virtualização se necessário |
| Scroll infinito lento | Testes de performance, limite de items em DOM |
| Animações laggy | Usar CSS transforms, requestAnimationFrame |

---

## File List

- [ ] src/components/corporate/PipelineFeed.tsx
- [ ] src/components/corporate/ActivityCard.tsx
- [ ] src/components/corporate/StatusBadge.tsx
- [ ] src/components/corporate/ApprovalGate.tsx
- [ ] src/data/mockActivities.ts

---

## Change Log

- **2026-02-17:** Story created (US-202) in YOLO batch
- **Status:** Draft - Awaiting @po validation
