# 1.6: Implementar Templates Edit√°veis

**Status:** Ready
**Sprint:** 4
**Points:** 8
**Epic:** EPIC-001

---

## User Story

**Como** planejador financeiro
**Quero** personalizar os templates padr√£o de atas
**Para que** elas reflitam meu estilo e marca pessoal

---

## Description

Implementar tela de configura√ß√£o de templates permitindo edi√ß√£o dos templates padr√£o de Ata de Reuni√£o e Ata de Investimentos, com lista de vari√°veis dispon√≠veis, preview em tempo real e op√ß√£o de restaurar padr√£o.

---

## Acceptance Criteria

### AC-006.1: Tela de Configura√ß√£o de Templates
- [ ] Menu: Settings > Templates
- [ ] Interface intuitiva e clara
- [ ] Tabs: Ata Reuni√£o | Ata Investimentos
- [ ] Sem erros ao alternar abas

### AC-006.2: Editor para Ata de Reuni√£o
- [ ] Text area com template atual
- [ ] Rich text: bold, italic, lista, emojis
- [ ] Height: ~400px, scroll√°vel
- [ ] Placeholder com hint

### AC-006.3: Editor para Ata de Investimentos
- [ ] Text area com template atual
- [ ] Rich text: bold, italic, lista, emojis
- [ ] Height: ~400px, scroll√°vel
- [ ] Placeholder com hint

### AC-006.4: Vari√°veis Dispon√≠veis
- [ ] Lista ao lado do editor
- [ ] Vari√°veis por tipo:
  - Reuni√£o: {cliente}, {data}, {data_proxima}, {hora_proxima}, {topicos}, {pendencias}, {materiais}
  - Investimentos: {cliente}, {data}, {objetivo}, {total_geral}, {acoes}, {fiis}, {internacional}, {rf}, {cripto}, {notas}
- [ ] Click para copiar vari√°vel
- [ ] Tooltip explicativo

### AC-006.5: Preview em Tempo Real
- [ ] Painel ao lado direito
- [ ] Renderiza template com vari√°veis fake
- [ ] Atualiza enquanto digita
- [ ] Scroll sincronizado (opcional)

### AC-006.6: Restaurar Template Padr√£o
- [ ] Bot√£o "Restaurar Padr√£o"
- [ ] Confirma√ß√£o antes de restaurar
- [ ] Volta para template original
- [ ] Mensagem de sucesso

### AC-006.7: Templates Salvos por Usu√°rio
- [ ] LocalStorage: templates_{user_id}
- [ ] Supabase: table custom_templates (backup)
- [ ] Auto-save a cada 2 segundos
- [ ] Confirma√ß√£o ao sair com altera√ß√µes

---

## Scope

### IN (Inclu√≠do)
- Tela de configura√ß√£o
- Editores rich-text
- Lista de vari√°veis
- Preview em tempo real
- Restaurar padr√£o
- Salvamento autom√°tico

### OUT (N√£o Inclu√≠do)
- M√∫ltiplos templates alternativos
- Versionamento de templates
- Compartilhar templates com outros usu√°rios
- Library de templates prontos

---

## Technical Notes

### Implementation Approach

1. **Components**
   - `TemplateSettings.tsx` (NEW) - container principal
   - `TemplateEditor.tsx` (NEW) - editor com vari√°veis
   - `TemplatePreview.tsx` (NEW) - preview renderizado
   - `VariableList.tsx` (NEW) - lista de vari√°veis

2. **Data Structure**
```typescript
interface CustomTemplate {
  id: string;
  user_id: string;
  type: 'reuniao' | 'investimentos';
  content: string;
  is_active: boolean;
  created_at: Date;
  updated_at: Date;
}

const VARIABLE_DEFINITIONS = {
  reuniao: [
    { key: '{cliente}', description: 'Nome do cliente' },
    { key: '{data}', description: 'Data da reuni√£o' },
    // ...
  ],
  investimentos: [
    { key: '{cliente}', description: 'Nome do cliente' },
    // ...
  ]
};
```

3. **Default Templates**
```typescript
const DEFAULT_TEMPLATES = {
  reuniao: `üìù ATA DE REUNI√ÉO
...`,
  investimentos: `üìë ATA DE RECOMENDACAO DE INVESTIMENTOS
...`
};
```

4. **Services**
   - `templateService.ts` (NEW) - CRUD templates
   - `templateRenderer.ts` (NEW) - renderizar com vari√°veis

5. **File Structure**
```
src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ templateService.ts (NEW)
‚îÇ   ‚îî‚îÄ‚îÄ templateRenderer.ts (NEW)
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ settings/
        ‚îî‚îÄ‚îÄ templates/
            ‚îú‚îÄ‚îÄ TemplateSettings.tsx (NEW)
            ‚îú‚îÄ‚îÄ TemplateEditor.tsx (NEW)
            ‚îú‚îÄ‚îÄ TemplatePreview.tsx (NEW)
            ‚îî‚îÄ‚îÄ VariableList.tsx (NEW)
```

### Template Rendering Example
```typescript
function renderTemplate(template: string, data: Record<string, any>): string {
  let rendered = template;

  Object.entries(data).forEach(([key, value]) => {
    const varKey = `{${key}}`;
    rendered = rendered.replace(new RegExp(varKey, 'g'), String(value));
  });

  return rendered;
}

// Usage
const ata = {
  cliente: 'Jo√£o Silva',
  data: '14/02/2026',
  // ...
};

const rendered = renderTemplate(customTemplate, ata);
```

---

## Definition of Done

- [ ] Tela de settings funcional
- [ ] Editores rich-text implementados
- [ ] Preview renderizando corretamente
- [ ] Vari√°veis listadas com tooltips
- [ ] Salvamento autom√°tico
- [ ] Restaurar padr√£o funcional
- [ ] Sincroniza√ß√£o Supabase
- [ ] Valida√ß√£o de vari√°veis obrigat√≥rias
- [ ] Responsive design
- [ ] Testes unit√°rios
- [ ] Sem console errors
- [ ] Commit e PR criado

---

## Dependencies

**Blocks:** None

**Depends On:** US-102, US-103 (usa templates)

---

## Business Value

**M√©dio** - Permite customiza√ß√£o, melhora brand

---

## Risks

| Risk | Mitigation |
|------|-----------|
| Template quebrado (vari√°veis faltando) | Valida√ß√£o, destaque em preview |
| Sync Supabase falhar | Fallback localStorage |
| Preview desincronizado | Debounce 500ms, useEffect bem constru√≠do |

---

## File List

- [ ] src/services/templateService.ts
- [ ] src/services/templateRenderer.ts
- [ ] src/components/settings/templates/TemplateSettings.tsx
- [ ] src/components/settings/templates/TemplateEditor.tsx
- [ ] src/components/settings/templates/TemplatePreview.tsx
- [ ] src/components/settings/templates/VariableList.tsx

---

## Change Log

- **2026-02-17:** Story created (US-106)
- **2026-02-17:** @po validated - VERDICT: GO (10/10 checklist)
- **Status:** Ready for development

