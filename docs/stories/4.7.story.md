# 4.7: Pipeline Feed (Atividades em Tempo Real)

**Status:** Ready
**Sprint:** 7
**Points:** 8
**Epic:** EPIC-004

---

## User Story

**Como** empres√°rio
**Quero** ver um feed lateral com atividades dos departamentos em tempo real
**Para que** eu tenha visibility do que est√° acontecendo na empresa

---

## Description

Implementar feed lateral (ou bottom em mobile) que mostra:
- Atividades de todos os departamentos
- Status badges (RUNNING, IDLE, WAITING, COMPLETED, ERROR)
- Scroll infinito com pagina√ß√£o (100 por p√°gina)
- Filtro por departamento
- Novas atividades aparecem no topo com anima√ß√£o
- Clique expande detalhes

---

## Acceptance Criteria

### AC-407.1: Feed Posicionado Corretamente
- [ ] Desktop: sidebar direita (30% width)
- [ ] Tablet: accordion abaixo do mapa
- [ ] Mobile: tab separado
- [ ] Fixed height com scroll

### AC-407.2: Atividades Renderizadas
- [ ] Mostra: avatar, nome agente, hora, descri√ß√£o, status
- [ ] Avatar: 32√ó32px, rounded
- [ ] Nome: 14px semibold
- [ ] Hora: 12px gray, direita
- [ ] Descri√ß√£o: 12px, 2 linhas max (ellipsis)
- [ ] Status badge: inline, esquerda da descri√ß√£o

### AC-407.3: Status Badges
- [ ] RUNNING: üü¢ Verde (#10B981)
- [ ] IDLE: ‚ö™ Cinza (#9CA3AF)
- [ ] WAITING: üü° √Çmbar (#F59E0B)
- [ ] COMPLETED: ‚úÖ Verde
- [ ] ERROR: ‚ùå Vermelho (#EF4444)
- [ ] Badge √© clic√°vel (expande detalhes)

### AC-407.4: Scroll Infinito
- [ ] Ao chegar no final, carrega mais 100 itens
- [ ] Spinner durante loading
- [ ] Smooth scroll
- [ ] Sem jank em 1000+ atividades

### AC-407.5: Filtro por Departamento
- [ ] Dropdown: Todos | Financeiro | Marketing | Operacional | Comercial | etc
- [ ] Mostra apenas atividades do departamento
- [ ] Contador atualiza ("X atividades")
- [ ] Filtro persiste em session

### AC-407.6: Novas Atividades
- [ ] Atividade nova aparece no topo com anima√ß√£o slide + fade
- [ ] 300ms animation
- [ ] Som opcional (off por default)
- [ ] Contador "Novas atividades" no header (com badge)

### AC-407.7: Expandir Detalhes
- [ ] Clique em atividade expande card
- [ ] Mostra: description completa, metadata, timeline
- [ ] Bot√£o "Fechar" ou clique fora
- [ ] Anima√ß√£o smooth

### AC-407.8: Timestamp Amig√°vel
- [ ] "5 min atr√°s"
- [ ] "1 hora atr√°s"
- [ ] "Ontem"
- [ ] "3 dias atr√°s"
- [ ] Hover mostra data/hora exata

### AC-407.9: Sem Lags
- [ ] Feed atualiza sem lag
- [ ] Renderiza < 500ms mesmo com 1000 itens
- [ ] Virtualization para otimiza√ß√£o se necess√°rio

---

## Scope

### IN
- Feed layout + styling
- Atividade cards
- Status badges
- Filtro por departamento
- Scroll infinito
- Mock data (100+ atividades)
- Timestamp formatting

### OUT
- Real-time Supabase sync (fase 2)
- Websocket updates
- Notifica√ß√µes push
- Busca/search
- Atividades agrupadas por hora
- Advanced filtering (by agent, date range)

---

## Technical Notes

### Data Structure
```typescript
interface ActivityFeedItem {
  id: string;
  department: 'financeiro' | 'marketing' | 'operacional' | 'comercial' | 'estrategia' | 'ideacao' | 'producao' | 'design';
  agent_name: string;
  agent_role: string;
  description: string;
  status: 'running' | 'idle' | 'waiting' | 'completed' | 'error';
  requires_approval: boolean;
  approved_by?: string;
  metadata?: Record<string, any>;
  created_at: string;
}
```

### Components
```
ActivityFeed.tsx
‚îú‚îÄ‚îÄ FeedHeader (filtro + counter)
‚îú‚îÄ‚îÄ ActivityList (virtualized)
‚îú‚îÄ‚îÄ ActivityCard (expandable)
‚îî‚îÄ‚îÄ LoadingSpinner
```

### Libraries
- **react-window:** Virtualization para performance
- **date-fns:** Timestamp formatting
- **framer-motion:** Animations

### Pagination
- 100 itens por p√°gina
- Load more ao scroll fim
- Total count no header

---

## Dependencies

**Depends On:** US-401 (Mapa - para layout positioning)
**Blocks:** US-408 (Gates - usa items do feed)

**Library Dependency:** react-window, framer-motion

---

## Definition of Done

- [x] Feed renders all activities
- [x] All AC passed
- [x] Scroll infinito working
- [x] Filter functional
- [x] Performance optimized (virtualization)
- [x] Mobile responsive
- [x] No console errors
- [x] Tests 75%+ coverage
- [x] Accessibility: keyboard nav, screen reader labels

---

## File List

- [ ] src/components/corporate/feed/ActivityFeed.tsx
- [ ] src/components/corporate/feed/ActivityCard.tsx
- [ ] src/components/corporate/feed/FeedHeader.tsx
- [ ] src/data/activityData.ts
- [ ] src/__tests__/activityFeed.test.ts

---

## Points Breakdown

- Layout + styling: 1.5 pts
- Activity cards: 1.5 pts
- Scroll infinito: 2 pts
- Filter: 1 pt
- Animations: 1 pt
- Virtualization + tests: 1 pt

---

## Change Log

- **2026-02-17:** Created
